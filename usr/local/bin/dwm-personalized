#!/bin/sh

DZEN2_STATUS="$HOME/bin/status_bar"
BG_IMG="$HOME/.dotfiles/wallpapers/blue-1920x1080.png"

feh --bg-scale $BG_IMG &        # set the background wallpaper
xsetroot -name "" &             # we have dzen2 status bar, set main WM window title to none
mpd $HOME/.mpdconf &            # start music player daemon
devmon &                        # automount removable devices

if [ ! -f "$DZEN2_STATUS" ]; then
    DZEN2_STATUS="echo 'dzen2 status is unavailable' | dzen2 -x 780 -y 0 -w 710 -h 20 -ta 'r' -p"
fi

while true; do
    (sleep 0.5 && $DZEN2_STATUS) & # run dzen2 status bar, need to make sure wm loads first

    # start dwm
    dwm > /dev/null # never had any errors anyway
    # if dwm exists with any error code, restart it
    if [ $? -eq 0 ]; then
        exit 0 # means exit clean => quit
    fi
    # dwm should be recompiled if changes were done
    # kill status bar so it can be restarted
    killall status_bar
done

